function [ name ] = mtspFormulaTranslate(form,lm)
%mtspFormulaTranslate - transform chemical formulae into simple abbreviated
%names. Obviously will be a finite list, but can expand as necessary

dict = {'Formula','Name';...
    'C14H28O2','FA(14:0)';...14
    'C15H30O2','FA(15:0)';...15
    'C16H32O2','FA(16:0)';...16
    'C16H30O2','FA(16:1)';...
    'C17H34O2','FA(17:0)';...17
    'C17H32O2','FA(17:1)';...
    'C18H36O2','FA(18:0)';...18
    'C18H34O2','FA(18:1)';...
    'C18H32O2','FA(18:2)';...
    'C18H30O2','FA(18:3)';...
    'C19H38O2','FA(19:0)';...19
    'C19H36O2','FA(19:1)';...
    'C19H34O2','FA(19:2)';...
    'C19H32O2','FA(19:3)';...
    'C20H40O2','FA(20:0)';...20
    'C20H38O2','FA(20:1)';...
    'C20H36O2','FA(20:2)';...
    'C20H34O2','FA(20:3)';...
    'C20H32O2','FA(20:4)';...
    'C21H42O2','FA(21:0)';...21
    'C21H40O2','FA(21:1)';...
    'C21H38O2','FA(21:2)';...
    'C21H36O2','FA(21:3)';...
    'C21H34O2','FA(21:4)';...
    'C22H44O2','FA(22:0)';...22
    'C22H42O2','FA(22:1)';...
    'C22H40O2','FA(22:2)';...
    'C22H38O2','FA(22:3)';...
    'C22H36O2','FA(22:4)';...
    'C22H34O2','FA(22:5)';...
    'C22H32O2','FA(22:6)';...
    'C23H46O2','FA(23:0)';...23
    'C23H44O2','FA(23:1)';...
    'C23H42O2','FA(23:2)';...
    'C23H40O2','FA(23:3)';...
    'C23H38O2','FA(23:4)';...
    'C23H36O2','FA(23:5)';...
    'C23H34O2','FA(23:6)';...
    'C24H48O2','FA(24:0)';...24
    'C24H46O2','FA(24:1)';...
    'C24H44O2','FA(24:2)';...
    'C24H42O2','FA(24:3)';...
    'C24H40O2','FA(24:4)';...
    'C24H38O2','FA(24:5)';...
    'C24H36O2','FA(24:6)'};%...
%     'C39H78NO8P','PC(31:0) | PE(34:0)';...
%     'C41H74NO7P','PE-P(36:4)';...
%     'C41H80NO8P','PC(33:1) | PE(36:1)';...
%     'C42H79O10P','PG(36:2)';...
%     'C42H80NO10P','PS(36:1)';...
%     'C43H78NO7P','PE-P(38:4)';...
%     'C43H78NO8P','PE(38:4)';...
%     'C47H83O13P','PI(38:4)';...
%     'C26H43NO5','[Bile salt]';...
%     'C26H45NO6S','[Bile salt]';...
%     'C20H28O2','Retinoic Acid';...
%     'C27H44O3','Calcitriol';...
%     'C28H42O2','Tocopherol';...
%     'C6H8O6','Ascorbic Acid',...
%     'C17H28O3S','N-undecylbenzenesulfonic acid';...
%     'C18H30O3S','2/4-dodecylbenezenesulfonic acid';...
%     'End','End'};


% Do the replacement
[name] = FAreplace(form,dict);

% How about the lipid database? Need to be aware of duplicated molecular
% formulae...
if nargin == 2
    
    [name2] = LIPreplace(form,lm);
    
    % Now combine the names...
    fx = ~strcmp(name2,'Unknown');
    name(fx) = name2(fx);
    
end
    

end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function [name] = FAreplace(form,dict)
% Here is the code to replace formula with name

numF = size(form,1);
name = repmat({'Unknown'},[numF 1]);

for n = 1:numF
    
    fx = strcmp(dict(:,1),form{n});
    
    if sum(fx) == 1
        name{n,1} = dict{fx,2};
    end
end

end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function [name] = LIPreplace(form,lm)
% Search through the lipid database for a match (or many) for the molecular
% formula

numF = size(form,1);
name = repmat({'Unknown'},[numF 1]);

for n = 1:numF
    
    fx = strcmp(lm.Formula,form{n});
    
    if sum(fx) == 1
        name{n,1} = lm.Name{fx};
    
    elseif sum(fx) == 2        
        % Now what? Merge them somehow? Can't face having to do this for 3
        % way lipid ties...
        
        % Let's compare the first two entries
        fx = find(fx);
        l1 = lm.Name{fx(1)};
        l2 = lm.Name{fx(2)};
        if strcmp(l1(1:2),l2(1:2))
            
            % Then these are likely P- and O- species
            if strcmp(l1(4),'O') && strcmp(l2(4),'P')
                name{n,1} = [lm.Name{fx(1)} '*'];
            elseif strcmp(l1,l2)
                name{n,1} = lm.Name{fx(1)};
            else
                %name{n,1} = 'Ambig.';
            end
            
        else
            %name{n,1} = 'Multiple';
        end
        
    elseif sum(fx) > 2
        lm.Name(fx)
    end
        
    %name(1:n)

end

end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

